#!/usr/bin/env node
// Script para insertar datos de demostración en Gestor Tienda Pro

const fs = require('fs');
const path = require('path');

const Database = require('better-sqlite3');

const DB_PATH = process.env.DB_PATH || path.join(__dirname, '..', 'data', 'gestor_tienda.db');
const FORCE = process.argv.includes('--force');
const schemaPath = path.join(__dirname, '..', 'schema.sql');

const dataDir = path.dirname(DB_PATH);
if (!fs.existsSync(dataDir)) {
  fs.mkdirSync(dataDir, { recursive: true });
}

const db = new Database(DB_PATH);

function tableExists(name) {
  return !!db.prepare("SELECT name FROM sqlite_master WHERE type = 'table' AND name = ?").get(name);
}

if (tableExists('clientes_new') && !tableExists('clientes')) {
  db.exec('DROP VIEW IF EXISTS vista_clientes_top');
  db.prepare('ALTER TABLE clientes_new RENAME TO clientes').run();
}

if (fs.existsSync(schemaPath)) {
  try {
    db.exec(fs.readFileSync(schemaPath, 'utf8'));
  } catch (error) {
    console.error('Error al aplicar schema.sql:', error.message);
    process.exit(1);
  }
}

db.pragma('foreign_keys = OFF');

if (FORCE) {
  const deletionOrder = [
    'notificaciones_enviadas',
    'citas',
    'ordenes_trabajo_repuestos',
    'ordenes_trabajo_servicios',
    'ordenes_trabajo',
    'ventas_detalle',
    'ventas',
    'compras_detalle',
    'compras',
    'cuentas_por_cobrar',
    'cuentas_por_pagar',
    'transacciones',
    'publicidades_guardadas',
    'publicaciones',
    'publicidad',
    'recordatorios',
    'vehiculos',
    'clientes',
    'productos',
    'proveedores',
    'categorias',
    'usuarios',
  ];

  db.transaction(() => {
    for (const table of deletionOrder) {
      db.prepare(`DELETE FROM ${table}`).run();
    }
    const resetTables = [
      'ventas_detalle',
      'compras_detalle',
      'ordenes_trabajo_servicios',
      'ordenes_trabajo_repuestos',
      'notificaciones_enviadas',
    ];
    for (const name of resetTables) {
      db.prepare('DELETE FROM sqlite_sequence WHERE name = ?').run(name);
    }
  })();
}

db.pragma('foreign_keys = ON');

const usuarios = [
  {
    id: 'usr_demo_admin',
    username: 'admin.demo',
    password: '$demo$admin$hash',
    nombre: 'Laura Sánchez',
    email: 'laura.admin@example.com',
    rol: 'admin',
    telegram_chat_id: null,
    activo: 1,
    created_at: '2025-01-05T09:00:00.000Z',
    updated_at: '2025-01-05T09:00:00.000Z',
  },
  {
    id: 'usr_demo_vendedor',
    username: 'ventas.julio',
    password: '$demo$ventas$hash',
    nombre: 'Julio Ortega',
    email: 'julio.ventas@example.com',
    rol: 'ventas',
    telegram_chat_id: null,
    activo: 1,
    created_at: '2025-01-05T09:05:00.000Z',
    updated_at: '2025-01-05T09:05:00.000Z',
  },
  {
    id: 'usr_demo_tecnico',
    username: 'tecnico.mario',
    password: '$demo$tecnico$hash',
    nombre: 'Mario Gómez',
    email: 'mario.tecnico@example.com',
    rol: 'tecnico',
    telegram_chat_id: '599887766',
    activo: 1,
    created_at: '2025-01-05T09:10:00.000Z',
    updated_at: '2025-01-05T09:10:00.000Z',
  },
  {
    id: 'usr_demo_finanzas',
    username: 'conta.cecilia',
    password: '$demo$conta$hash',
    nombre: 'Cecilia Rojas',
    email: 'cecilia.conta@example.com',
    rol: 'finanzas',
    telegram_chat_id: null,
    activo: 1,
    created_at: '2025-01-05T09:15:00.000Z',
    updated_at: '2025-01-05T09:15:00.000Z',
  },
  {
    id: 'usr_demo_marketing',
    username: 'mkt.vanessa',
    password: '$demo$mkt$hash',
    nombre: 'Vanessa Silva',
    email: 'vanessa.mkt@example.com',
    rol: 'marketing',
    telegram_chat_id: '533221144',
    activo: 1,
    created_at: '2025-01-05T09:20:00.000Z',
    updated_at: '2025-01-05T09:20:00.000Z',
  },
];

const categorias = [
  {
    id: 'cat_demo_servicios',
    nombre: 'Servicios de Mantenimiento',
    descripcion: 'Servicios realizados en el taller',
    created_at: '2025-01-04T08:00:00.000Z',
    updated_at: '2025-01-04T08:00:00.000Z',
  },
  {
    id: 'cat_demo_repuestos',
    nombre: 'Repuestos',
    descripcion: 'Repuestos originales y genéricos',
    created_at: '2025-01-04T08:05:00.000Z',
    updated_at: '2025-01-04T08:05:00.000Z',
  },
  {
    id: 'cat_demo_accesorios',
    nombre: 'Accesorios',
    descripcion: 'Accesorios para vehículos',
    created_at: '2025-01-04T08:10:00.000Z',
    updated_at: '2025-01-04T08:10:00.000Z',
  },
  {
    id: 'cat_demo_lubricantes',
    nombre: 'Lubricantes',
    descripcion: 'Aceites y lubricantes especializados',
    created_at: '2025-01-04T08:15:00.000Z',
    updated_at: '2025-01-04T08:15:00.000Z',
  },
  {
    id: 'cat_demo_diagnostico',
    nombre: 'Diagnóstico',
    descripcion: 'Equipos de diagnóstico electrónico',
    created_at: '2025-01-04T08:20:00.000Z',
    updated_at: '2025-01-04T08:20:00.000Z',
  },
];

const proveedores = [
  {
    id: 'prov_demo_autoPlus',
    nombre: 'AutoPlus Import',
    contacto: 'Marcos León',
    telefono: '+593-987-111-200',
    email: 'ventas@autoplus.com',
    direccion: 'Av. Las Américas 120',
    notas: 'Entrega semanal de repuestos',
    activo: 1,
    created_at: '2025-01-04T09:00:00.000Z',
    updated_at: '2025-01-04T09:00:00.000Z',
  },
  {
    id: 'prov_demo_lubritech',
    nombre: 'LubriTech Distribuidores',
    contacto: 'Silvia Andrade',
    telefono: '+593-987-111-300',
    email: 'contacto@lubritech.com',
    direccion: 'Km 8 Vía Daule',
    notas: 'Lubricantes certificados API',
    activo: 1,
    created_at: '2025-01-04T09:05:00.000Z',
    updated_at: '2025-01-04T09:05:00.000Z',
  },
  {
    id: 'prov_demo_motorParts',
    nombre: 'MotorParts Latam',
    contacto: 'Hernán Páez',
    telefono: '+593-987-111-400',
    email: 'hpaz@motorparts.lat',
    direccion: 'Parque Industrial 45',
    notas: 'Repuestos premium importados',
    activo: 1,
    created_at: '2025-01-04T09:10:00.000Z',
    updated_at: '2025-01-04T09:10:00.000Z',
  },
  {
    id: 'prov_demo_electroAuto',
    nombre: 'ElectroAuto Services',
    contacto: 'Natalia Moreira',
    telefono: '+593-987-111-500',
    email: 'nmoreira@electroauto.ec',
    direccion: 'Calle 9 de Octubre 233',
    notas: 'Equipos electrónicos y scanners',
    activo: 1,
    created_at: '2025-01-04T09:15:00.000Z',
    updated_at: '2025-01-04T09:15:00.000Z',
  },
  {
    id: 'prov_demo_premium',
    nombre: 'Premium Repuestos',
    contacto: 'David Paredes',
    telefono: '+593-987-111-600',
    email: 'dp@premiumrepuestos.ec',
    direccion: 'Av. Quito 890',
    notas: 'Condiciones de crédito a 30 días',
    activo: 1,
    created_at: '2025-01-04T09:20:00.000Z',
    updated_at: '2025-01-04T09:20:00.000Z',
  },
];

const productos = [
  {
    id: 'prod_demo_aceite',
    codigo: 'ACE-001',
    nombre: 'Aceite Sintético 5W30',
    descripcion: 'Aceite sintético premium para motores modernos.',
    categoria_id: 'cat_demo_lubricantes',
    proveedor_id: 'prov_demo_lubritech',
    precio_compra: 12.5,
    precio_venta: 18,
    stock: 40,
    stock_minimo: 10,
    imagen: null,
    activo: 1,
    created_at: '2025-01-04T10:00:00.000Z',
    updated_at: '2025-01-04T10:00:00.000Z',
  },
  {
    id: 'prod_demo_filtro_aire',
    codigo: 'FLT-210',
    nombre: 'Filtro de Aire Premium',
    descripcion: 'Filtro de aire de alto flujo compatible con sedanes.',
    categoria_id: 'cat_demo_repuestos',
    proveedor_id: 'prov_demo_autoPlus',
    precio_compra: 16,
    precio_venta: 25,
    stock: 25,
    stock_minimo: 5,
    imagen: null,
    activo: 1,
    created_at: '2025-01-04T10:05:00.000Z',
    updated_at: '2025-01-04T10:05:00.000Z',
  },
  {
    id: 'prod_demo_bujia_iridio',
    codigo: 'BUJ-045',
    nombre: 'Bujía de Iridio',
    descripcion: 'Bujía de larga duración con núcleo de iridio.',
    categoria_id: 'cat_demo_repuestos',
    proveedor_id: 'prov_demo_motorParts',
    precio_compra: 7.5,
    precio_venta: 12,
    stock: 80,
    stock_minimo: 15,
    imagen: null,
    activo: 1,
    created_at: '2025-01-04T10:10:00.000Z',
    updated_at: '2025-01-04T10:10:00.000Z',
  },
  {
    id: 'prod_demo_kit_frenos',
    codigo: 'FRN-320',
    nombre: 'Kit Frenos Delanteros',
    descripcion: 'Kit completo de frenos delanteros, pastillas y discos ventilados.',
    categoria_id: 'cat_demo_repuestos',
    proveedor_id: 'prov_demo_premium',
    precio_compra: 110,
    precio_venta: 150,
    stock: 15,
    stock_minimo: 4,
    imagen: null,
    activo: 1,
    created_at: '2025-01-04T10:15:00.000Z',
    updated_at: '2025-01-04T10:15:00.000Z',
  },
  {
    id: 'prod_demo_scanner_obd',
    codigo: 'SCN-500',
    nombre: 'Scanner OBD-II Portátil',
    descripcion: 'Scanner portátil con conectividad Bluetooth y reportes avanzados.',
    categoria_id: 'cat_demo_diagnostico',
    proveedor_id: 'prov_demo_electroAuto',
    precio_compra: 60,
    precio_venta: 85,
    stock: 10,
    stock_minimo: 2,
    imagen: null,
    activo: 1,
    created_at: '2025-01-04T10:20:00.000Z',
    updated_at: '2025-01-04T10:20:00.000Z',
  },
];

const clientes = [
  {
    id: 'cli_demo_juan',
    nombre: 'Juan Pérez',
    cedula: '0912345678',
    telefono: '+593-99-100-2000',
    email: 'juan.perez@example.com',
    direccion: 'Calle 18 y Av. Central',
    ciudad: 'Guayaquil',
    categoria: 'Premium',
    total_comprado: 237.65,
    notas: 'Prefiere contacto por WhatsApp en horarios laborales.',
    activo: 1,
    vehiculo_favorito_id: null,
    telegram_chat_id: '515001122',
    created_at: '2025-01-05T12:00:00.000Z',
    updated_at: '2025-01-05T12:00:00.000Z',
  },
  {
    id: 'cli_demo_maria',
    nombre: 'María López',
    cedula: '0923456789',
    telefono: '+593-98-200-3001',
    email: 'maria.lopez@example.com',
    direccion: 'Av. Kennedy y Calle 5',
    ciudad: 'Guayaquil',
    categoria: 'Regular',
    total_comprado: 400.1,
    notas: 'Solicita recordatorios de mantenimiento trimestrales.',
    activo: 1,
    vehiculo_favorito_id: null,
    telegram_chat_id: '515001133',
    created_at: '2025-01-05T12:10:00.000Z',
    updated_at: '2025-01-05T12:10:00.000Z',
  },
  {
    id: 'cli_demo_carlos',
    nombre: 'Carlos Vera',
    cedula: '0934567890',
    telefono: '+593-97-300-4002',
    email: 'carlos.vera@example.com',
    direccion: 'Urbanización Los Álamos, Villa 31',
    ciudad: 'Samborondón',
    categoria: 'Premium',
    total_comprado: 271.5,
    notas: 'Cuenta empresa para facturación electrónica.',
    activo: 1,
    vehiculo_favorito_id: null,
    telegram_chat_id: null,
    created_at: '2025-01-05T12:20:00.000Z',
    updated_at: '2025-01-05T12:20:00.000Z',
  },
  {
    id: 'cli_demo_ana',
    nombre: 'Ana Cedeño',
    cedula: '0945678901',
    telefono: '+593-96-400-5003',
    email: 'ana.cedeno@example.com',
    direccion: 'Barrio Las Lomas, Mz 14',
    ciudad: 'Guayaquil',
    categoria: 'Regular',
    total_comprado: 156.1,
    notas: 'Requiere factura con datos personales.',
    activo: 1,
    vehiculo_favorito_id: null,
    telegram_chat_id: '515001144',
    created_at: '2025-01-05T12:30:00.000Z',
    updated_at: '2025-01-05T12:30:00.000Z',
  },
  {
    id: 'cli_demo_valeria',
    nombre: 'Valeria Castillo',
    cedula: '0956789012',
    telefono: '+593-95-500-6004',
    email: 'valeria.castillo@example.com',
    direccion: 'Ciudad Celeste, Torre 2',
    ciudad: 'Daule',
    categoria: 'VIP',
    total_comprado: 515.25,
    notas: 'Cliente VIP con plan de mantenimiento anual.',
    activo: 1,
    vehiculo_favorito_id: null,
    telegram_chat_id: '515001155',
    created_at: '2025-01-05T12:40:00.000Z',
    updated_at: '2025-01-05T12:40:00.000Z',
  },
];

const vehiculos = [
  {
    id: 'veh_demo_focus',
    cliente_id: 'cli_demo_juan',
    marca: 'Ford',
    modelo: 'Focus',
    anio: 2018,
    placa: 'GBA-2145',
    vin: '1FADP3K28JL210145',
    color: 'Azul',
    kilometraje: 78500,
    fecha_ultimo_servicio: '2024-12-18',
    notas: 'Cambio de correa de distribución en 2024.',
    created_at: '2025-01-06T09:30:00.000Z',
    updated_at: '2025-01-06T09:30:00.000Z',
  },
  {
    id: 'veh_demo_corolla',
    cliente_id: 'cli_demo_maria',
    marca: 'Toyota',
    modelo: 'Corolla',
    anio: 2020,
    placa: 'GYX-5080',
    vin: 'JTDBE46K273016789',
    color: 'Blanco',
    kilometraje: 45200,
    fecha_ultimo_servicio: '2024-11-30',
    notas: 'Historial completo de mantenimiento.',
    created_at: '2025-01-06T09:35:00.000Z',
    updated_at: '2025-01-06T09:35:00.000Z',
  },
  {
    id: 'veh_demo_hilux',
    cliente_id: 'cli_demo_carlos',
    marca: 'Toyota',
    modelo: 'Hilux',
    anio: 2017,
    placa: 'PCX-7712',
    vin: 'MR0HA3CD300123456',
    color: 'Gris',
    kilometraje: 120300,
    fecha_ultimo_servicio: '2024-12-05',
    notas: 'Uso comercial, requiere inspecciones frecuentes.',
    created_at: '2025-01-06T09:40:00.000Z',
    updated_at: '2025-01-06T09:40:00.000Z',
  },
  {
    id: 'veh_demo_sentra',
    cliente_id: 'cli_demo_ana',
    marca: 'Nissan',
    modelo: 'Sentra',
    anio: 2019,
    placa: 'LBC-9034',
    vin: '3N1AB7AP0KY321567',
    color: 'Negro',
    kilometraje: 60350,
    fecha_ultimo_servicio: '2024-10-28',
    notas: 'Reporte de vibración en frenado leve.',
    created_at: '2025-01-06T09:45:00.000Z',
    updated_at: '2025-01-06T09:45:00.000Z',
  },
  {
    id: 'veh_demo_civic',
    cliente_id: 'cli_demo_valeria',
    marca: 'Honda',
    modelo: 'Civic',
    anio: 2021,
    placa: 'TBA-6611',
    vin: '2HGFC2F89MH123890',
    color: 'Rojo',
    kilometraje: 28400,
    fecha_ultimo_servicio: '2024-12-20',
    notas: 'Suscrita al plan de mantenimiento VIP.',
    created_at: '2025-01-06T09:50:00.000Z',
    updated_at: '2025-01-06T09:50:00.000Z',
  },
];

const ventas = [
  {
    id: 'ven_demo_001',
    numero: 'VENT-2025-001',
    fecha: '2025-01-05T14:30:00.000Z',
    cliente_id: 'cli_demo_juan',
    cliente_nombre: 'Juan Pérez',
    subtotal: 61,
    iva: 9.15,
    descuento: 5,
    total: 65.15,
    metodo_pago: 'tarjeta',
    estado: 'completada',
    notas: 'Cambio de aceite y filtro de aire.',
    created_at: '2025-01-05T14:30:00.000Z',
    updated_at: '2025-01-05T14:30:00.000Z',
  },
  {
    id: 'ven_demo_002',
    numero: 'VENT-2025-002',
    fecha: '2025-01-08T16:00:00.000Z',
    cliente_id: 'cli_demo_maria',
    cliente_nombre: 'María López',
    subtotal: 174,
    iva: 26.1,
    descuento: 10,
    total: 190.1,
    metodo_pago: 'transferencia',
    estado: 'completada',
    notas: 'Kit de frenos y ajuste de sistema.',
    created_at: '2025-01-08T16:00:00.000Z',
    updated_at: '2025-01-08T16:00:00.000Z',
  },
  {
    id: 'ven_demo_003',
    numero: 'VENT-2025-003',
    fecha: '2025-01-10T11:15:00.000Z',
    cliente_id: 'cli_demo_carlos',
    cliente_nombre: 'Carlos Vera',
    subtotal: 110,
    iva: 16.5,
    descuento: 0,
    total: 126.5,
    metodo_pago: 'efectivo',
    estado: 'completada',
    notas: 'Scanner OBD-II y filtro de aire.',
    created_at: '2025-01-10T11:15:00.000Z',
    updated_at: '2025-01-10T11:15:00.000Z',
  },
  {
    id: 'ven_demo_004',
    numero: 'VENT-2025-004',
    fecha: '2025-01-11T09:50:00.000Z',
    cliente_id: 'cli_demo_ana',
    cliente_nombre: 'Ana Cedeño',
    subtotal: 54,
    iva: 8.1,
    descuento: 4,
    total: 58.1,
    metodo_pago: 'tarjeta',
    estado: 'completada',
    notas: 'Sustitución de bujías premium.',
    created_at: '2025-01-11T09:50:00.000Z',
    updated_at: '2025-01-11T09:50:00.000Z',
  },
  {
    id: 'ven_demo_005',
    numero: 'VENT-2025-005',
    fecha: '2025-01-12T13:25:00.000Z',
    cliente_id: 'cli_demo_valeria',
    cliente_nombre: 'Valeria Castillo',
    subtotal: 235,
    iva: 35.25,
    descuento: 15,
    total: 255.25,
    metodo_pago: 'tarjeta',
    estado: 'completada',
    notas: 'Kit de frenos y scanner portátil.',
    created_at: '2025-01-12T13:25:00.000Z',
    updated_at: '2025-01-12T13:25:00.000Z',
  },
];

const ventasDetalle = [
  {
    id: 1,
    venta_id: 'ven_demo_001',
    producto_id: 'prod_demo_aceite',
    producto_nombre: 'Aceite Sintético 5W30',
    cantidad: 2,
    precio_unitario: 18,
    total: 36,
  },
  {
    id: 2,
    venta_id: 'ven_demo_001',
    producto_id: 'prod_demo_filtro_aire',
    producto_nombre: 'Filtro de Aire Premium',
    cantidad: 1,
    precio_unitario: 25,
    total: 25,
  },
  {
    id: 3,
    venta_id: 'ven_demo_002',
    producto_id: 'prod_demo_kit_frenos',
    producto_nombre: 'Kit Frenos Delanteros',
    cantidad: 1,
    precio_unitario: 150,
    total: 150,
  },
  {
    id: 4,
    venta_id: 'ven_demo_002',
    producto_id: 'prod_demo_bujia_iridio',
    producto_nombre: 'Bujía de Iridio',
    cantidad: 2,
    precio_unitario: 12,
    total: 24,
  },
  {
    id: 5,
    venta_id: 'ven_demo_003',
    producto_id: 'prod_demo_scanner_obd',
    producto_nombre: 'Scanner OBD-II Portátil',
    cantidad: 1,
    precio_unitario: 85,
    total: 85,
  },
  {
    id: 6,
    venta_id: 'ven_demo_003',
    producto_id: 'prod_demo_filtro_aire',
    producto_nombre: 'Filtro de Aire Premium',
    cantidad: 1,
    precio_unitario: 25,
    total: 25,
  },
  {
    id: 7,
    venta_id: 'ven_demo_004',
    producto_id: 'prod_demo_bujia_iridio',
    producto_nombre: 'Bujía de Iridio',
    cantidad: 3,
    precio_unitario: 12,
    total: 36,
  },
  {
    id: 8,
    venta_id: 'ven_demo_004',
    producto_id: 'prod_demo_aceite',
    producto_nombre: 'Aceite Sintético 5W30',
    cantidad: 1,
    precio_unitario: 18,
    total: 18,
  },
  {
    id: 9,
    venta_id: 'ven_demo_005',
    producto_id: 'prod_demo_kit_frenos',
    producto_nombre: 'Kit Frenos Delanteros',
    cantidad: 1,
    precio_unitario: 150,
    total: 150,
  },
  {
    id: 10,
    venta_id: 'ven_demo_005',
    producto_id: 'prod_demo_scanner_obd',
    producto_nombre: 'Scanner OBD-II Portátil',
    cantidad: 1,
    precio_unitario: 85,
    total: 85,
  },
];

const compras = [
  {
    id: 'comp_demo_001',
    numero: 'COMP-2025-001',
    fecha: '2025-01-03T10:00:00.000Z',
    proveedor_id: 'prov_demo_autoPlus',
    proveedor_nombre: 'AutoPlus Import',
    moneda: 'USD',
    subtotal: 298,
    iva: 0,
    otros_impuestos: 0,
    total: 298,
    estado: 'completada',
    estado_pago: 'pagado',
    monto_pagado: 298,
    notas: 'Reposición de filtros y kits básicos.',
    created_at: '2025-01-03T10:00:00.000Z',
    updated_at: '2025-01-03T10:00:00.000Z',
  },
  {
    id: 'comp_demo_002',
    numero: 'COMP-2025-002',
    fecha: '2025-01-04T09:20:00.000Z',
    proveedor_id: 'prov_demo_lubritech',
    proveedor_nombre: 'LubriTech Distribuidores',
    moneda: 'USD',
    subtotal: 325,
    iva: 0,
    otros_impuestos: 0,
    total: 325,
    estado: 'completada',
    estado_pago: 'pendiente',
    monto_pagado: 150,
    notas: 'Orden mensual de aceites sintéticos.',
    created_at: '2025-01-04T09:20:00.000Z',
    updated_at: '2025-01-04T09:20:00.000Z',
  },
  {
    id: 'comp_demo_003',
    numero: 'COMP-2025-003',
    fecha: '2025-01-05T08:40:00.000Z',
    proveedor_id: 'prov_demo_motorParts',
    proveedor_nombre: 'MotorParts Latam',
    moneda: 'USD',
    subtotal: 775,
    iva: 0,
    otros_impuestos: 0,
    total: 775,
    estado: 'completada',
    estado_pago: 'pendiente',
    monto_pagado: 0,
    notas: 'Stock adicional de bujías y kits de freno.',
    created_at: '2025-01-05T08:40:00.000Z',
    updated_at: '2025-01-05T08:40:00.000Z',
  },
  {
    id: 'comp_demo_004',
    numero: 'COMP-2025-004',
    fecha: '2025-01-06T11:10:00.000Z',
    proveedor_id: 'prov_demo_electroAuto',
    proveedor_nombre: 'ElectroAuto Services',
    moneda: 'USD',
    subtotal: 240,
    iva: 0,
    otros_impuestos: 0,
    total: 240,
    estado: 'completada',
    estado_pago: 'pagado',
    monto_pagado: 240,
    notas: 'Scanners OBD-II para demostraciones.',
    created_at: '2025-01-06T11:10:00.000Z',
    updated_at: '2025-01-06T11:10:00.000Z',
  },
  {
    id: 'comp_demo_005',
    numero: 'COMP-2025-005',
    fecha: '2025-01-07T14:25:00.000Z',
    proveedor_id: 'prov_demo_premium',
    proveedor_nombre: 'Premium Repuestos',
    moneda: 'USD',
    subtotal: 660,
    iva: 0,
    otros_impuestos: 0,
    total: 660,
    estado: 'completada',
    estado_pago: 'pendiente',
    monto_pagado: 300,
    notas: 'Kits de freno premium para clientes VIP.',
    created_at: '2025-01-07T14:25:00.000Z',
    updated_at: '2025-01-07T14:25:00.000Z',
  },
];

const comprasDetalle = [
  {
    id: 1,
    compra_id: 'comp_demo_001',
    producto_id: 'prod_demo_filtro_aire',
    producto_nombre: 'Filtro de Aire Premium',
    descripcion: null,
    unidad: null,
    cantidad: 8,
    precio_unitario: 16,
    total: 128,
  },
  {
    id: 2,
    compra_id: 'comp_demo_001',
    producto_id: 'prod_demo_kit_frenos',
    producto_nombre: 'Kit Frenos Delanteros',
    descripcion: null,
    unidad: null,
    cantidad: 1,
    precio_unitario: 110,
    total: 110,
  },
  {
    id: 3,
    compra_id: 'comp_demo_001',
    producto_id: 'prod_demo_bujia_iridio',
    producto_nombre: 'Bujía de Iridio',
    descripcion: null,
    unidad: null,
    cantidad: 8,
    precio_unitario: 7.5,
    total: 60,
  },
  {
    id: 4,
    compra_id: 'comp_demo_002',
    producto_id: 'prod_demo_aceite',
    producto_nombre: 'Aceite Sintético 5W30',
    descripcion: null,
    unidad: 'bidón',
    cantidad: 20,
    precio_unitario: 12.5,
    total: 250,
  },
  {
    id: 5,
    compra_id: 'comp_demo_002',
    producto_id: 'prod_demo_bujia_iridio',
    producto_nombre: 'Bujía de Iridio',
    descripcion: null,
    unidad: null,
    cantidad: 10,
    precio_unitario: 7.5,
    total: 75,
  },
  {
    id: 6,
    compra_id: 'comp_demo_003',
    producto_id: 'prod_demo_bujia_iridio',
    producto_nombre: 'Bujía de Iridio',
    descripcion: null,
    unidad: null,
    cantidad: 30,
    precio_unitario: 7.5,
    total: 225,
  },
  {
    id: 7,
    compra_id: 'comp_demo_003',
    producto_id: 'prod_demo_kit_frenos',
    producto_nombre: 'Kit Frenos Delanteros',
    descripcion: null,
    unidad: null,
    cantidad: 5,
    precio_unitario: 110,
    total: 550,
  },
  {
    id: 8,
    compra_id: 'comp_demo_004',
    producto_id: 'prod_demo_scanner_obd',
    producto_nombre: 'Scanner OBD-II Portátil',
    descripcion: 'Versión Bluetooth con estuche resistente.',
    unidad: null,
    cantidad: 4,
    precio_unitario: 60,
    total: 240,
  },
  {
    id: 9,
    compra_id: 'comp_demo_005',
    producto_id: 'prod_demo_kit_frenos',
    producto_nombre: 'Kit Frenos Delanteros',
    descripcion: 'Incluye pastillas cerámicas y herrajes.',
    unidad: 'juego',
    cantidad: 6,
    precio_unitario: 110,
    total: 660,
  },
];

const cuentasPorCobrar = [
  {
    id: 'cxc_demo_001',
    cliente_id: 'cli_demo_juan',
    venta_id: 'ven_demo_001',
    monto: 65.15,
    monto_pagado: 30,
    fecha: '2025-01-05',
    fecha_vencimiento: '2025-02-05',
    estado: 'pendiente',
    notas: 'Pago parcial con tarjeta, saldo en efectivo.',
    created_at: '2025-01-06T08:00:00.000Z',
    updated_at: '2025-01-06T08:00:00.000Z',
  },
  {
    id: 'cxc_demo_002',
    cliente_id: 'cli_demo_maria',
    venta_id: 'ven_demo_002',
    monto: 190.1,
    monto_pagado: 190.1,
    fecha: '2025-01-08',
    fecha_vencimiento: '2025-01-22',
    estado: 'pagado',
    notas: 'Cancelado por transferencia inmediata.',
    created_at: '2025-01-08T18:10:00.000Z',
    updated_at: '2025-01-08T18:10:00.000Z',
  },
  {
    id: 'cxc_demo_003',
    cliente_id: 'cli_demo_carlos',
    venta_id: 'ven_demo_003',
    monto: 126.5,
    monto_pagado: 0,
    fecha: '2025-01-10',
    fecha_vencimiento: '2025-02-10',
    estado: 'pendiente',
    notas: 'Cliente solicitó crédito a 30 días.',
    created_at: '2025-01-10T12:00:00.000Z',
    updated_at: '2025-01-10T12:00:00.000Z',
  },
  {
    id: 'cxc_demo_004',
    cliente_id: 'cli_demo_ana',
    venta_id: 'ven_demo_004',
    monto: 58.1,
    monto_pagado: 58.1,
    fecha: '2025-01-11',
    fecha_vencimiento: '2025-01-25',
    estado: 'pagado',
    notas: 'Pago con tarjeta diferido una cuota.',
    created_at: '2025-01-11T10:30:00.000Z',
    updated_at: '2025-01-11T10:30:00.000Z',
  },
  {
    id: 'cxc_demo_005',
    cliente_id: 'cli_demo_valeria',
    venta_id: 'ven_demo_005',
    monto: 255.25,
    monto_pagado: 200,
    fecha: '2025-01-12',
    fecha_vencimiento: '2025-02-12',
    estado: 'pendiente',
    notas: 'Saldo pendiente para ser debitado automáticamente.',
    created_at: '2025-01-12T14:00:00.000Z',
    updated_at: '2025-01-12T14:00:00.000Z',
  },
];

const cuentasPorPagar = [
  {
    id: 'cxp_demo_001',
    proveedor_id: 'prov_demo_autoPlus',
    compra_id: 'comp_demo_001',
    monto: 298,
    monto_pagado: 298,
    fecha: '2025-01-03',
    fecha_vencimiento: '2025-01-17',
    estado: 'pagado',
    notas: 'Pago con transferencia bancaria.',
    created_at: '2025-01-03T12:10:00.000Z',
    updated_at: '2025-01-03T12:10:00.000Z',
  },
  {
    id: 'cxp_demo_002',
    proveedor_id: 'prov_demo_lubritech',
    compra_id: 'comp_demo_002',
    monto: 325,
    monto_pagado: 150,
    fecha: '2025-01-04',
    fecha_vencimiento: '2025-02-04',
    estado: 'pendiente',
    notas: 'Queda saldo por cancelar en 20 días.',
    created_at: '2025-01-04T10:00:00.000Z',
    updated_at: '2025-01-04T10:00:00.000Z',
  },
  {
    id: 'cxp_demo_003',
    proveedor_id: 'prov_demo_motorParts',
    compra_id: 'comp_demo_003',
    monto: 775,
    monto_pagado: 0,
    fecha: '2025-01-05',
    fecha_vencimiento: '2025-02-05',
    estado: 'pendiente',
    notas: 'Compra con crédito a 30 días.',
    created_at: '2025-01-05T09:30:00.000Z',
    updated_at: '2025-01-05T09:30:00.000Z',
  },
  {
    id: 'cxp_demo_004',
    proveedor_id: 'prov_demo_electroAuto',
    compra_id: 'comp_demo_004',
    monto: 240,
    monto_pagado: 240,
    fecha: '2025-01-06',
    fecha_vencimiento: '2025-01-20',
    estado: 'pagado',
    notas: 'Pago en punto con tarjeta corporativa.',
    created_at: '2025-01-06T12:00:00.000Z',
    updated_at: '2025-01-06T12:00:00.000Z',
  },
  {
    id: 'cxp_demo_005',
    proveedor_id: 'prov_demo_premium',
    compra_id: 'comp_demo_005',
    monto: 660,
    monto_pagado: 300,
    fecha: '2025-01-07',
    fecha_vencimiento: '2025-02-07',
    estado: 'pendiente',
    notas: 'Saldo pendiente sujeto a entrega de nuevos kits.',
    created_at: '2025-01-07T15:00:00.000Z',
    updated_at: '2025-01-07T15:00:00.000Z',
  },
];

const transacciones = [
  {
    id: 'txn_demo_001',
    tipo: 'ingreso',
    categoria: 'ventas',
    monto: 65.15,
    fecha: '2025-01-05',
    descripcion: 'Venta VENT-2025-001',
    metodo_pago: 'tarjeta',
    referencia_id: 'ven_demo_001',
    created_at: '2025-01-05T15:00:00.000Z',
  },
  {
    id: 'txn_demo_002',
    tipo: 'ingreso',
    categoria: 'ventas',
    monto: 190.1,
    fecha: '2025-01-08',
    descripcion: 'Venta VENT-2025-002',
    metodo_pago: 'transferencia',
    referencia_id: 'ven_demo_002',
    created_at: '2025-01-08T18:30:00.000Z',
  },
  {
    id: 'txn_demo_003',
    tipo: 'egreso',
    categoria: 'compras',
    monto: 298,
    fecha: '2025-01-03',
    descripcion: 'Compra COMP-2025-001',
    metodo_pago: 'transferencia',
    referencia_id: 'comp_demo_001',
    created_at: '2025-01-03T12:30:00.000Z',
  },
  {
    id: 'txn_demo_004',
    tipo: 'egreso',
    categoria: 'compras',
    monto: 240,
    fecha: '2025-01-06',
    descripcion: 'Compra COMP-2025-004',
    metodo_pago: 'tarjeta',
    referencia_id: 'comp_demo_004',
    created_at: '2025-01-06T12:30:00.000Z',
  },
  {
    id: 'txn_demo_005',
    tipo: 'ingreso',
    categoria: 'servicios taller',
    monto: 150,
    fecha: '2025-01-06',
    descripcion: 'Pago parcial orden OT-2025-001',
    metodo_pago: 'efectivo',
    referencia_id: 'ot_demo_001',
    created_at: '2025-01-06T18:00:00.000Z',
  },
];

const recordatorios = [
  {
    id: 'rec_demo_001',
    titulo: 'Cambio de aceite programado',
    descripcion: 'Recordar al cliente el cambio de aceite.',
    tipo: 'mantenimiento',
    fecha: '2025-02-05',
    hora: '09:00',
    completado: 0,
    recurrente: 'ninguno',
    cliente_id: 'cli_demo_juan',
    vehiculo_id: 'veh_demo_focus',
    created_at: '2025-01-09T07:30:00.000Z',
    updated_at: '2025-01-09T07:30:00.000Z',
  },
  {
    id: 'rec_demo_002',
    titulo: 'Inspección de frenos',
    descripcion: 'Verificar pastillas y discos del Corolla.',
    tipo: 'mantenimiento',
    fecha: '2025-02-12',
    hora: '10:30',
    completado: 0,
    recurrente: 'mensual',
    cliente_id: 'cli_demo_maria',
    vehiculo_id: 'veh_demo_corolla',
    created_at: '2025-01-09T07:35:00.000Z',
    updated_at: '2025-01-09T07:35:00.000Z',
  },
  {
    id: 'rec_demo_003',
    titulo: 'Seguimiento flota Hilux',
    descripcion: 'Revisar suspensión posterior y fugas.',
    tipo: 'seguimiento',
    fecha: '2025-01-25',
    hora: '11:00',
    completado: 1,
    recurrente: 'ninguno',
    cliente_id: 'cli_demo_carlos',
    vehiculo_id: 'veh_demo_hilux',
    created_at: '2025-01-09T07:40:00.000Z',
    updated_at: '2025-01-15T16:00:00.000Z',
  },
  {
    id: 'rec_demo_004',
    titulo: 'Revisión de suspensión',
    descripcion: 'Evaluar ruidos en suspensión del Sentra.',
    tipo: 'diagnostico',
    fecha: '2025-01-20',
    hora: '15:00',
    completado: 0,
    recurrente: 'ninguno',
    cliente_id: 'cli_demo_ana',
    vehiculo_id: 'veh_demo_sentra',
    created_at: '2025-01-09T07:45:00.000Z',
    updated_at: '2025-01-09T07:45:00.000Z',
  },
  {
    id: 'rec_demo_005',
    titulo: 'Recordatorio plan VIP',
    descripcion: 'Enviar beneficios trimestrales del plan VIP.',
    tipo: 'marketing',
    fecha: '2025-03-01',
    hora: '08:30',
    completado: 0,
    recurrente: 'trimestral',
    cliente_id: 'cli_demo_valeria',
    vehiculo_id: 'veh_demo_civic',
    created_at: '2025-01-09T07:50:00.000Z',
    updated_at: '2025-01-09T07:50:00.000Z',
  },
];

const publicidad = [
  {
    id: 'publi_demo_001',
    titulo: 'Promo cambio de aceite enero',
    contenido: 'Aprovecha 10% de descuento en cambio de aceite sintético durante enero.',
    red_social: 'Facebook',
    fecha: '2025-01-07',
    estado: 'programada',
    imagen: null,
    created_at: '2025-01-07T08:15:00.000Z',
    updated_at: '2025-01-07T08:15:00.000Z',
  },
  {
    id: 'publi_demo_002',
    titulo: 'Diagnóstico gratis con tu compra',
    contenido: 'Lleva tu vehículo y recibe diagnóstico electrónico gratis al comprar repuestos.',
    red_social: 'Instagram',
    fecha: '2025-01-09',
    estado: 'publicada',
    imagen: null,
    created_at: '2025-01-09T09:20:00.000Z',
    updated_at: '2025-01-09T09:20:00.000Z',
  },
  {
    id: 'publi_demo_003',
    titulo: 'Campaña frenos seguros',
    contenido: 'Chequeo de frenos sin costo durante esta semana.',
    red_social: 'WhatsApp',
    fecha: '2025-01-10',
    estado: 'enviada',
    imagen: null,
    created_at: '2025-01-10T08:05:00.000Z',
    updated_at: '2025-01-10T08:05:00.000Z',
  },
  {
    id: 'publi_demo_004',
    titulo: 'Kit frenos premium',
    contenido: 'Financia tu kit de frenos premium en 3 cuotas sin interés.',
    red_social: 'Facebook',
    fecha: '2025-01-12',
    estado: 'programada',
    imagen: null,
    created_at: '2025-01-12T09:10:00.000Z',
    updated_at: '2025-01-12T09:10:00.000Z',
  },
  {
    id: 'publi_demo_005',
    titulo: 'Semana del Scanner OBD',
    contenido: 'Demostraciones en vivo de diagnóstico con scanner portátil.',
    red_social: 'Instagram',
    fecha: '2025-01-14',
    estado: 'borrador',
    imagen: null,
    created_at: '2025-01-14T08:45:00.000Z',
    updated_at: '2025-01-14T08:45:00.000Z',
  },
];

const publicaciones = [
  {
    id: 'post_demo_001',
    titulo: 'Resultado cambio de frenos',
    contenido: 'Hoy entregamos un Corolla con frenos renovados y listos para la carretera.',
    red_social: 'Instagram',
    fecha: '2025-01-07',
    estado: 'publicada',
    metricas: JSON.stringify({ likes: 120, comments: 8, shares: 5 }),
    created_at: '2025-01-07T18:30:00.000Z',
  },
  {
    id: 'post_demo_002',
    titulo: 'Tips de mantenimiento',
    contenido: 'Recomendamos revisar las bujías cada 20.000 km para evitar fallas.',
    red_social: 'Facebook',
    fecha: '2025-01-08',
    estado: 'publicada',
    metricas: JSON.stringify({ likes: 85, comments: 4, shares: 12 }),
    created_at: '2025-01-08T19:00:00.000Z',
  },
  {
    id: 'post_demo_003',
    titulo: 'Detrás del taller',
    contenido: 'Nuestro equipo técnico calibrando scanners OBD-II.',
    red_social: 'Instagram',
    fecha: '2025-01-09',
    estado: 'publicada',
    metricas: JSON.stringify({ likes: 140, comments: 15, shares: 9 }),
    created_at: '2025-01-09T20:10:00.000Z',
  },
  {
    id: 'post_demo_004',
    titulo: 'Cliente VIP satisfecho',
    contenido: 'Valeria confía en nuestro plan de mantenimiento VIP para su Civic 2021.',
    red_social: 'Facebook',
    fecha: '2025-01-10',
    estado: 'publicada',
    metricas: JSON.stringify({ likes: 95, comments: 6, shares: 3 }),
    created_at: '2025-01-10T21:15:00.000Z',
  },
  {
    id: 'post_demo_005',
    titulo: 'Agenda tu diagnóstico',
    contenido: 'Agenda tu diagnóstico electrónico y recibe un reporte detallado.',
    red_social: 'LinkedIn',
    fecha: '2025-01-11',
    estado: 'borrador',
    metricas: null,
    created_at: '2025-01-11T13:40:00.000Z',
  },
];

const publicidadesGuardadas = [
  {
    id: 'pubg_demo_001',
    titulo: 'Campaña aceite premium',
    producto_id: 'prod_demo_aceite',
    producto_data: JSON.stringify({ id: 'prod_demo_aceite', nombre: 'Aceite Sintético 5W30' }),
    promocion: '10% en servicio de cambio',
    redes_sociales: JSON.stringify(['Facebook', 'Instagram']),
    textos_publicacion: JSON.stringify({
      copy: 'Protege tu motor con nuestro aceite sintético premium.',
      hashtags: ['#Mantenimiento', '#AceiteSintetico'],
    }),
    prompt_imagen: 'Foto de un mecánico aplicando aceite en un motor limpio',
    fecha_creacion: '2025-01-06',
    usado: 0,
    created_at: '2025-01-06T13:20:00.000Z',
  },
  {
    id: 'pubg_demo_002',
    titulo: 'Plantilla frenos seguros',
    producto_id: 'prod_demo_kit_frenos',
    producto_data: JSON.stringify({ id: 'prod_demo_kit_frenos', nombre: 'Kit Frenos Delanteros' }),
    promocion: 'Instalación gratis en enero',
    redes_sociales: JSON.stringify(['Facebook', 'WhatsApp']),
    textos_publicacion: JSON.stringify({
      copy: 'Frenado seguro para tu familia.',
      hashtags: ['#Frenos', '#SeguridadVial'],
    }),
    prompt_imagen: 'Auto en elevador mostrando sistema de frenos nuevo',
    fecha_creacion: '2025-01-07',
    usado: 1,
    created_at: '2025-01-07T13:20:00.000Z',
  },
  {
    id: 'pubg_demo_003',
    titulo: 'Secuencia scanner OBD',
    producto_id: 'prod_demo_scanner_obd',
    producto_data: JSON.stringify({
      id: 'prod_demo_scanner_obd',
      nombre: 'Scanner OBD-II Portátil',
    }),
    promocion: 'Diagnóstico gratis por lanzamiento',
    redes_sociales: JSON.stringify(['Instagram', 'TikTok']),
    textos_publicacion: JSON.stringify({
      copy: 'Descubre las alertas escondidas de tu auto.',
      hashtags: ['#ScannerOBD', '#TallerInteligente'],
    }),
    prompt_imagen: 'Animación de scanner OBD conectado vía Bluetooth',
    fecha_creacion: '2025-01-08',
    usado: 0,
    created_at: '2025-01-08T13:20:00.000Z',
  },
  {
    id: 'pubg_demo_004',
    titulo: 'Promoción bujías iridio',
    producto_id: 'prod_demo_bujia_iridio',
    producto_data: JSON.stringify({ id: 'prod_demo_bujia_iridio', nombre: 'Bujía de Iridio' }),
    promocion: '4x3 en bujías seleccionadas',
    redes_sociales: JSON.stringify(['Facebook']),
    textos_publicacion: JSON.stringify({
      copy: 'Potencia y eficiencia en cada encendido.',
      hashtags: ['#Bujias', '#Iridio'],
    }),
    prompt_imagen: 'Detalle de bujías brillantes sobre mesa de taller',
    fecha_creacion: '2025-01-09',
    usado: 0,
    created_at: '2025-01-09T13:20:00.000Z',
  },
  {
    id: 'pubg_demo_005',
    titulo: 'Seguimiento clientes VIP',
    producto_id: null,
    producto_data: null,
    promocion: 'Beneficios exclusivos plan VIP',
    redes_sociales: JSON.stringify(['Email', 'WhatsApp']),
    textos_publicacion: JSON.stringify({
      copy: 'Descubre las ventajas personalizadas para tu vehículo premium.',
      hashtags: ['#ClienteVIP', '#ServicioPremium'],
    }),
    prompt_imagen: 'Gráfico elegante con íconos de mantenimiento y comodidad',
    fecha_creacion: '2025-01-10',
    usado: 0,
    created_at: '2025-01-10T13:20:00.000Z',
  },
];

const ordenesTrabajo = [
  {
    id: 'ot_demo_001',
    numero: 'OT-2025-001',
    cliente_id: 'cli_demo_juan',
    vehiculo_id: 'veh_demo_focus',
    fecha_recepcion: '2025-01-03T08:45:00.000Z',
    fecha_entrega_estimada: '2025-01-05T16:00:00.000Z',
    fecha_entrega_real: '2025-01-05T15:30:00.000Z',
    problema_reportado: 'Vibración al frenar y testigo de aceite encendido.',
    diagnostico_inicial: 'Nivel de aceite bajo y desgaste de pastillas.',
    tecnico_asignado_id: 'usr_demo_tecnico',
    estado: 'entregado',
    subtotal_servicios: 120,
    subtotal_repuestos: 40,
    descuento: 10,
    iva: 22.5,
    total: 172.5,
    monto_pagado: 150,
    ruta_factura: 'uploads/invoices/ot_demo_001.pdf',
    observaciones: 'Cliente recogió vehículo antes del cierre.',
    autorizacion_cliente: 1,
    created_at: '2025-01-03T08:45:00.000Z',
    updated_at: '2025-01-05T15:30:00.000Z',
  },
  {
    id: 'ot_demo_002',
    numero: 'OT-2025-002',
    cliente_id: 'cli_demo_maria',
    vehiculo_id: 'veh_demo_corolla',
    fecha_recepcion: '2025-01-08T09:10:00.000Z',
    fecha_entrega_estimada: '2025-01-11T12:00:00.000Z',
    fecha_entrega_real: null,
    problema_reportado: 'Chirrido constante al frenar y pedal esponjoso.',
    diagnostico_inicial: 'Pastillas y discos desgastados, líquido contaminado.',
    tecnico_asignado_id: 'usr_demo_tecnico',
    estado: 'en_proceso',
    subtotal_servicios: 150,
    subtotal_repuestos: 65,
    descuento: 20,
    iva: 29.25,
    total: 224.25,
    monto_pagado: 120,
    ruta_factura: null,
    observaciones: 'Esperando autorización final para repuestos premium.',
    autorizacion_cliente: 1,
    created_at: '2025-01-08T09:10:00.000Z',
    updated_at: '2025-01-09T17:40:00.000Z',
  },
  {
    id: 'ot_demo_003',
    numero: 'OT-2025-003',
    cliente_id: 'cli_demo_carlos',
    vehiculo_id: 'veh_demo_hilux',
    fecha_recepcion: '2025-01-10T07:55:00.000Z',
    fecha_entrega_estimada: '2025-01-12T18:00:00.000Z',
    fecha_entrega_real: '2025-01-12T16:30:00.000Z',
    problema_reportado: 'Pérdida de potencia en subidas.',
    diagnostico_inicial: 'Filtro de aire saturado y bujías con carbonilla.',
    tecnico_asignado_id: 'usr_demo_tecnico',
    estado: 'finalizado',
    subtotal_servicios: 110,
    subtotal_repuestos: 45,
    descuento: 0,
    iva: 23.25,
    total: 178.25,
    monto_pagado: 178.25,
    ruta_factura: 'uploads/invoices/ot_demo_003.pdf',
    observaciones: 'Cliente corporativo solicitó informe detallado.',
    autorizacion_cliente: 1,
    created_at: '2025-01-10T07:55:00.000Z',
    updated_at: '2025-01-12T16:30:00.000Z',
  },
  {
    id: 'ot_demo_004',
    numero: 'OT-2025-004',
    cliente_id: 'cli_demo_ana',
    vehiculo_id: 'veh_demo_sentra',
    fecha_recepcion: '2025-01-11T10:20:00.000Z',
    fecha_entrega_estimada: '2025-01-13T15:00:00.000Z',
    fecha_entrega_real: null,
    problema_reportado: 'Ruido en suspensión y dirección ligera.',
    diagnostico_inicial: 'Amortiguadores delanteros con fuga.',
    tecnico_asignado_id: 'usr_demo_tecnico',
    estado: 'en_proceso',
    subtotal_servicios: 85,
    subtotal_repuestos: 28,
    descuento: 5,
    iva: 16.05,
    total: 124.05,
    monto_pagado: 80,
    ruta_factura: null,
    observaciones: 'Requiere confirmación para reemplazar amortiguadores.',
    autorizacion_cliente: 0,
    created_at: '2025-01-11T10:20:00.000Z',
    updated_at: '2025-01-11T18:15:00.000Z',
  },
  {
    id: 'ot_demo_005',
    numero: 'OT-2025-005',
    cliente_id: 'cli_demo_valeria',
    vehiculo_id: 'veh_demo_civic',
    fecha_recepcion: '2025-01-12T08:40:00.000Z',
    fecha_entrega_estimada: '2025-01-15T14:30:00.000Z',
    fecha_entrega_real: null,
    problema_reportado: 'Solicitud plan premium completo y calibración ADAS.',
    diagnostico_inicial: 'Revisión general con calibración de sensores.',
    tecnico_asignado_id: 'usr_demo_tecnico',
    estado: 'espera_repuestos',
    subtotal_servicios: 160,
    subtotal_repuestos: 90,
    descuento: 12,
    iva: 35.7,
    total: 273.7,
    monto_pagado: 0,
    ruta_factura: null,
    observaciones: 'Esperando llegada de sensores calibrados.',
    autorizacion_cliente: 1,
    created_at: '2025-01-12T08:40:00.000Z',
    updated_at: '2025-01-12T08:40:00.000Z',
  },
];

const ordenesTrabajoServicios = [
  {
    id: 1,
    orden_id: 'ot_demo_001',
    servicio_nombre: 'Diagnóstico y revisión de frenos',
    descripcion: 'Inspección completa del sistema de frenado.',
    horas_labor: 1.5,
    precio_hora: 40,
    precio_total_servicio: 60,
  },
  {
    id: 2,
    orden_id: 'ot_demo_001',
    servicio_nombre: 'Cambio de aceite sintético',
    descripcion: 'Drenado de aceite, cambio de filtro y rellenado.',
    horas_labor: 1.2,
    precio_hora: 50,
    precio_total_servicio: 60,
  },
  {
    id: 3,
    orden_id: 'ot_demo_002',
    servicio_nombre: 'Mantenimiento de frenos completo',
    descripcion: 'Rectificación de discos y limpieza general.',
    horas_labor: 2.5,
    precio_hora: 48,
    precio_total_servicio: 120,
  },
  {
    id: 4,
    orden_id: 'ot_demo_002',
    servicio_nombre: 'Purgado y reemplazo de líquido',
    descripcion: 'Renovación de líquido de frenos y purgado del sistema.',
    horas_labor: 0.8,
    precio_hora: 37.5,
    precio_total_servicio: 30,
  },
  {
    id: 5,
    orden_id: 'ot_demo_003',
    servicio_nombre: 'Limpieza de sistema de admisión',
    descripcion: 'Limpieza de cuerpo de aceleración y filtros.',
    horas_labor: 1.7,
    precio_hora: 45,
    precio_total_servicio: 76.5,
  },
  {
    id: 6,
    orden_id: 'ot_demo_003',
    servicio_nombre: 'Reemplazo de bujías',
    descripcion: 'Cambio de bujías con calibración de chispa.',
    horas_labor: 0.8,
    precio_hora: 42,
    precio_total_servicio: 33.6,
  },
  {
    id: 7,
    orden_id: 'ot_demo_004',
    servicio_nombre: 'Diagnóstico de suspensión',
    descripcion: 'Prueba de amortiguadores y chequeo de bujes.',
    horas_labor: 1.1,
    precio_hora: 38,
    precio_total_servicio: 41.8,
  },
  {
    id: 8,
    orden_id: 'ot_demo_004',
    servicio_nombre: 'Ajuste de dirección',
    descripcion: 'Revisión y ajuste básico de dirección.',
    horas_labor: 1,
    precio_hora: 43,
    precio_total_servicio: 43,
  },
  {
    id: 9,
    orden_id: 'ot_demo_005',
    servicio_nombre: 'Calibración de sensores ADAS',
    descripcion: 'Calibración avanzada de sensores y cámaras.',
    horas_labor: 2.5,
    precio_hora: 52,
    precio_total_servicio: 130,
  },
  {
    id: 10,
    orden_id: 'ot_demo_005',
    servicio_nombre: 'Detalle de interior premium',
    descripcion: 'Limpieza profunda y protección de superficies.',
    horas_labor: 1.2,
    precio_hora: 25,
    precio_total_servicio: 30,
  },
];

const ordenesTrabajoRepuestos = [
  {
    id: 1,
    orden_id: 'ot_demo_001',
    producto_id: null,
    nombre_repuesto: 'Kit de pastillas delanteras',
    cantidad: 1,
    precio_unitario: 40,
    precio_total_repuesto: 40,
  },
  {
    id: 2,
    orden_id: 'ot_demo_002',
    producto_id: 'prod_demo_kit_frenos',
    nombre_repuesto: 'Kit Frenos Delanteros',
    cantidad: 1,
    precio_unitario: 65,
    precio_total_repuesto: 65,
  },
  {
    id: 3,
    orden_id: 'ot_demo_003',
    producto_id: 'prod_demo_bujia_iridio',
    nombre_repuesto: 'Juego de bujías iridio',
    cantidad: 1,
    precio_unitario: 45,
    precio_total_repuesto: 45,
  },
  {
    id: 4,
    orden_id: 'ot_demo_004',
    producto_id: null,
    nombre_repuesto: 'Kit amortiguadores delanteros',
    cantidad: 1,
    precio_unitario: 28,
    precio_total_repuesto: 28,
  },
  {
    id: 5,
    orden_id: 'ot_demo_005',
    producto_id: 'prod_demo_scanner_obd',
    nombre_repuesto: 'Sensores calibrados ADAS',
    cantidad: 1,
    precio_unitario: 90,
    precio_total_repuesto: 90,
  },
];

const citas = [
  {
    id: 'cita_demo_001',
    cliente_id: 'cli_demo_juan',
    vehiculo_id: 'veh_demo_focus',
    tipo_servicio: 'Cambio de aceite',
    fecha: '2025-01-15',
    hora: '09:30',
    duracion: 60,
    tecnico_id: 'usr_demo_tecnico',
    descripcion: 'Cambio de aceite con filtro premium.',
    notas: 'Cliente esperará en sala.',
    prioridad: 'normal',
    recordatorio: '1_dia',
    estado: 'programado',
    created_at: '2025-01-07T10:00:00.000Z',
    updated_at: '2025-01-07T10:00:00.000Z',
  },
  {
    id: 'cita_demo_002',
    cliente_id: 'cli_demo_maria',
    vehiculo_id: 'veh_demo_corolla',
    tipo_servicio: 'Chequeo de frenos',
    fecha: '2025-01-18',
    hora: '11:00',
    duracion: 90,
    tecnico_id: 'usr_demo_tecnico',
    descripcion: 'Revisión posterior al cambio de pastillas.',
    notas: 'Coordinar movilidad de regreso.',
    prioridad: 'alta',
    recordatorio: '2_horas',
    estado: 'programado',
    created_at: '2025-01-09T11:00:00.000Z',
    updated_at: '2025-01-09T11:00:00.000Z',
  },
  {
    id: 'cita_demo_003',
    cliente_id: 'cli_demo_carlos',
    vehiculo_id: 'veh_demo_hilux',
    tipo_servicio: 'Inspección general',
    fecha: '2025-01-19',
    hora: '08:00',
    duracion: 120,
    tecnico_id: 'usr_demo_tecnico',
    descripcion: 'Chequeo preventivo para flota.',
    notas: 'Traer historial de mantenimiento',
    prioridad: 'urgente',
    recordatorio: '1_dia',
    estado: 'programado',
    created_at: '2025-01-10T10:30:00.000Z',
    updated_at: '2025-01-10T10:30:00.000Z',
  },
  {
    id: 'cita_demo_004',
    cliente_id: 'cli_demo_ana',
    vehiculo_id: 'veh_demo_sentra',
    tipo_servicio: 'Diagnóstico suspensión',
    fecha: '2025-01-16',
    hora: '15:30',
    duracion: 60,
    tecnico_id: 'usr_demo_tecnico',
    descripcion: 'Revisión de amortiguadores con prueba de ruta.',
    notas: 'Cliente requiere informe escrito.',
    prioridad: 'normal',
    recordatorio: '2_horas',
    estado: 'programado',
    created_at: '2025-01-08T12:15:00.000Z',
    updated_at: '2025-01-08T12:15:00.000Z',
  },
  {
    id: 'cita_demo_005',
    cliente_id: 'cli_demo_valeria',
    vehiculo_id: 'veh_demo_civic',
    tipo_servicio: 'Calibración ADAS',
    fecha: '2025-01-22',
    hora: '10:00',
    duracion: 150,
    tecnico_id: 'usr_demo_tecnico',
    descripcion: 'Calibración de sensores ADAS luego del servicio premium.',
    notas: 'Coordinar transporte VIP.',
    prioridad: 'alta',
    recordatorio: '1_dia',
    estado: 'programado',
    created_at: '2025-01-12T09:20:00.000Z',
    updated_at: '2025-01-12T09:20:00.000Z',
  },
];

const notificacionesEnviadas = [
  {
    id: 1,
    chat_id: '515001122',
    cliente_id: 'cli_demo_juan',
    vehiculo_id: 'veh_demo_focus',
    tipo_servicio: 'mantenimiento',
    mensaje: 'Hola Juan, recuerda tu cambio de aceite programado para el 15 de enero.',
    telegram_message_id: 'msg_demo_001',
    fecha_envio: '2025-01-09T09:00:00.000Z',
    entregado: 1,
    tipo: 'recordatorio',
    created_at: '2025-01-09T09:00:00.000Z',
  },
  {
    id: 2,
    chat_id: '515001133',
    cliente_id: 'cli_demo_maria',
    vehiculo_id: 'veh_demo_corolla',
    tipo_servicio: 'mantenimiento',
    mensaje: 'María, te esperamos el 18 de enero para revisar tus frenos.',
    telegram_message_id: 'msg_demo_002',
    fecha_envio: '2025-01-10T10:15:00.000Z',
    entregado: 1,
    tipo: 'recordatorio',
    created_at: '2025-01-10T10:15:00.000Z',
  },
  {
    id: 3,
    chat_id: null,
    cliente_id: 'cli_demo_carlos',
    vehiculo_id: 'veh_demo_hilux',
    tipo_servicio: 'seguimiento',
    mensaje: 'Carlos, adjuntamos el informe de mantenimiento de tu Hilux.',
    telegram_message_id: 'msg_demo_003',
    fecha_envio: '2025-01-12T17:00:00.000Z',
    entregado: 1,
    tipo: 'notificacion',
    created_at: '2025-01-12T17:00:00.000Z',
  },
  {
    id: 4,
    chat_id: '515001144',
    cliente_id: 'cli_demo_ana',
    vehiculo_id: 'veh_demo_sentra',
    tipo_servicio: 'diagnostico',
    mensaje: 'Ana, ya tenemos el informe de suspensión listo para tu aprobación.',
    telegram_message_id: 'msg_demo_004',
    fecha_envio: '2025-01-11T19:10:00.000Z',
    entregado: 1,
    tipo: 'notificacion',
    created_at: '2025-01-11T19:10:00.000Z',
  },
  {
    id: 5,
    chat_id: '515001155',
    cliente_id: 'cli_demo_valeria',
    vehiculo_id: 'veh_demo_civic',
    tipo_servicio: 'marketing',
    mensaje: 'Valeria, ya puedes canjear tus beneficios VIP de enero.',
    telegram_message_id: 'msg_demo_005',
    fecha_envio: '2025-01-13T08:45:00.000Z',
    entregado: 1,
    tipo: 'notificacion',
    created_at: '2025-01-13T08:45:00.000Z',
  },
];

const datasets = [
  { table: 'usuarios', rows: usuarios },
  { table: 'categorias', rows: categorias },
  { table: 'proveedores', rows: proveedores },
  { table: 'productos', rows: productos },
  { table: 'clientes', rows: clientes },
  { table: 'vehiculos', rows: vehiculos },
  { table: 'ventas', rows: ventas },
  { table: 'ventas_detalle', rows: ventasDetalle },
  { table: 'compras', rows: compras },
  { table: 'compras_detalle', rows: comprasDetalle },
  { table: 'cuentas_por_cobrar', rows: cuentasPorCobrar },
  { table: 'cuentas_por_pagar', rows: cuentasPorPagar },
  { table: 'transacciones', rows: transacciones },
  { table: 'recordatorios', rows: recordatorios },
  { table: 'publicidad', rows: publicidad },
  { table: 'publicaciones', rows: publicaciones },
  { table: 'publicidades_guardadas', rows: publicidadesGuardadas },
  { table: 'ordenes_trabajo', rows: ordenesTrabajo },
  { table: 'ordenes_trabajo_servicios', rows: ordenesTrabajoServicios },
  { table: 'ordenes_trabajo_repuestos', rows: ordenesTrabajoRepuestos },
  { table: 'citas', rows: citas },
  { table: 'notificaciones_enviadas', rows: notificacionesEnviadas },
];

const missingTables = datasets
  .map(({ table }) => table)
  .filter((table, index, arr) => arr.indexOf(table) === index)
  .filter((table) => !tableExists(table));

if (missingTables.length) {
  console.error('No se encontraron las tablas requeridas:', missingTables.join(', '));
  console.error('Ejecute el backend o aplique schema.sql antes de sembrar datos de demostración.');
  db.close();
  process.exit(1);
}

function hasRows(table) {
  const { count } = db.prepare(`SELECT COUNT(*) AS count FROM ${table}`).get();
  return count > 0;
}

function insertRows(table, rows) {
  if (!rows.length) {
    return 0;
  }
  const columns = Object.keys(rows[0]);
  const placeholders = columns.map((col) => `@${col}`).join(', ');
  const stmt = db.prepare(
    `INSERT OR IGNORE INTO ${table} (${columns.join(', ')}) VALUES (${placeholders})`
  );
  let inserted = 0;
  for (const row of rows) {
    inserted += stmt.run(row).changes ? 1 : 0;
  }
  return inserted;
}

const results = [];

const seed = db.transaction(() => {
  for (const { table, rows } of datasets) {
    if (!FORCE && hasRows(table)) {
      results.push({ table, status: 'skipped', reason: 'existing data' });
      continue;
    }
    const inserted = insertRows(table, rows);
    results.push({ table, status: 'seeded', inserted });
  }

  const favoriteLinks = [
    { cliente: 'cli_demo_juan', vehiculo: 'veh_demo_focus' },
    { cliente: 'cli_demo_maria', vehiculo: 'veh_demo_corolla' },
    { cliente: 'cli_demo_carlos', vehiculo: 'veh_demo_hilux' },
    { cliente: 'cli_demo_ana', vehiculo: 'veh_demo_sentra' },
    { cliente: 'cli_demo_valeria', vehiculo: 'veh_demo_civic' },
  ];

  const updateFavorite = db.prepare(
    'UPDATE clientes SET vehiculo_favorito_id = @vehiculo, updated_at = @updated_at WHERE id = @cliente'
  );
  let updatedFavorites = 0;
  for (const link of favoriteLinks) {
    updatedFavorites += updateFavorite.run({
      vehiculo: link.vehiculo,
      cliente: link.cliente,
      updated_at: '2025-01-06T10:15:00.000Z',
    }).changes;
  }
  if (updatedFavorites > 0) {
    results.push({ table: 'clientes', status: 'favorites-linked', updated: updatedFavorites });
  }
});

seed();

console.log('📦 Datos de demostración para Gestor Tienda Pro');
for (const result of results) {
  if (result.status === 'seeded') {
    console.log(`  ✔ ${result.table}: ${result.inserted} registros insertados`);
  } else if (result.status === 'favorites-linked') {
    console.log(`  ↺ ${result.table}: ${result.updated} clientes enlazados con vehículo favorito`);
  } else {
    console.log(`  ⚠ ${result.table}: se omitió (${result.reason})`);
  }
}

if (!FORCE) {
  console.log(
    '\nEjecute con --force para limpiar tablas y volver a cargar los datos de demostración.'
  );
}

db.close();
